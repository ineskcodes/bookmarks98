<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>{{ title }}</title>
		<link rel="stylesheet" href="{{ '/scss/main.css' | url }}" />
		<script>
			(function () {
				// Check if localStorage is supported and available
				// source: https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API/Using_the_Web_Storage_API
				function storageAvailable(type) {
					let storage;
					try {
						storage = window[type];
						const x = '__storage_test__';
						storage.setItem(x, x);
						storage.removeItem(x);
						return true;
					} catch (e) {
						return (
							e instanceof DOMException &&
							(e.code === 22 ||
								e.code === 1014 ||
								e.name === 'QuotaExceededError' ||
								e.name === 'NS_ERROR_DOM_QUOTA_REACHED') &&
							storage &&
							storage.length !== 0
						);
					}
				}

				if (storageAvailable) {
					const wallpaper = localStorage.getItem('wallpaper');
					const displayMode = localStorage.getItem('display');
					const root = document.documentElement;
					const icons = Object.keys(localStorage).filter(item => item !== "wallpaper" && item !== "display");

					
					icons.forEach((item) => {
						const pos = JSON.parse(localStorage.getItem(item));
						document.documentElement.style.setProperty(`--${item}-x`, `${pos.x}px`);
						document.documentElement.style.setProperty(`--${item}-y`, `${pos.y}px`);
					});

					if (wallpaper) {
						root.style.setProperty('--wallpaper', `url('../${wallpaper}.png')`);
					}

					if (displayMode) {
						switch (displayMode) {
							case 'center':
								root.style.setProperty(`--size`, 'auto');
								root.style.setProperty(`--preview-size`, 'auto');
								root.style.setProperty('--repeat', 'no-repeat');
								root.style.setProperty('--position', 'center');
								break;

							case 'tile':
								root.style.setProperty(`--size`, 'auto');
								root.style.setProperty(`--preview-size`, '22.5% auto');
								root.style.setProperty('--repeat', 'repeat');
								root.style.setProperty('--position', 'auto');
								break;
								

							default:
								root.style.setProperty(`--size`, '100% 100%');
								root.style.setProperty(`--preview-size`, '100% 100%');
								root.style.setProperty('--repeat', 'no-repeat');
								root.style.setProperty('--position', 'auto');
								break;
						}
					}

					window.addEventListener('DOMContentLoaded', () => {
						const wallpaperRadios = Array.from(
							document.querySelectorAll('input[type="radio"]')
						);
						const displayOptions = Array.from(
							document.querySelectorAll("select[name='display'] option")
						);

						let currentWallpaperRadio = wallpaperRadios.find((radio) => radio.value === "none");
						
						if (wallpaper && wallpaperRadios.find((radio) => radio.value === wallpaper)) {
							currentWallpaperRadio = wallpaperRadios.find((radio) => radio.value === wallpaper);
						}				

						const currentDisplayMode = displayMode
						? displayOptions.find((option) => option.value === displayMode)
						: displayOptions.find((option) => option.value === 'tile');

						
						wallpaperRadios.forEach(el => {
							el.checked = false;
							el.classList.remove("applied");	
						});
						currentWallpaperRadio.checked = true;
						currentWallpaperRadio.classList.add("applied");		
						currentDisplayMode.selected = true;		
					});
				}
			})();
		</script>
	</head>
	<body>
		<div data-page="{{ pageHook }}" class="visually-hidden"></div>
		<div class="[ root ] [ scrollbar ]">
			<div class="root__desktop">
				{% include "partials/site-head.html" %} {% include
				"partials/main-content.html" %} {% include "partials/settings.html" %}
			</div>
			<div class="root__taskbar"> {% include "partials/site-foot.html" %} </div>
		</div>

		<script defer type="module" src="{{ '/js/main.js' | url }}"></script>
	</body>
</html>
