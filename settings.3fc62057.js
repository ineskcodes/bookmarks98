!function(){function e(e,t,s,i){Object.defineProperty(e,t,{get:s,set:i,enumerable:!0,configurable:!0})}var t=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequireb18d,s=t.register;s("kdgQu",function(s,i){e(s.exports,"default",function(){return o});var a=t("fow3s"),r=t("cbNRq"),l=t("fLH6v");class n{constructor(){this.setupElements(),this.loadWallpapers(),this.loadTheme(),this.init()}setupElements(){this.container=this.query(".settings"),this.popup=this.query(".popup",this.container),this.alert={container:this.query(".alert",this.container),firstFocusable:this.query("#alert-close-btn",this.container),closeButtons:this.query(".alert button",this.container,!0),heading:this.query(".alert__heading",this.container),message:this.query(".alert__message",this.container),outer:this.query("#alert-outer",this.container)},this.form=this.query("form",this.container),this.switcher=this.query(".switcher__wallpapers:not([data-placeholder])",this.form),this.buttons={open:this.query("#settings-open-btn",this.container),apply:this.query("#settings-apply-btn",this.container),cancel:this.query("#settings-cancel-btn",this.container),close:this.query("#settings-close-btn",this.container)},this.previewBox=this.query("#wallpaper-preview",this.popup),this.displaySelect=this.query("#display-select",this.form),this.themeSelect=this.query("#theme-select",this.form),this.browseInput=this.query("#browse-input",this.popup),this.dialogs=[this.popup,this.alert.container],this.wallpaperLabels=this.switcher.children,this.pathPrefix=location.pathname.match(/^\/.+?\//)}query(e,t=document,s=!1){return s?t.querySelectorAll(e):t.querySelector(e)}loadWallpapers(){localStorage.getItem("wallpapers")?this.wallpapers=JSON.parse(localStorage.getItem("wallpapers")):this.wallpapers=(0,l.wallpapers).map(e=>({name:this.formatName(e),src:this.generateUrl(e),isEnabled:!1,isCustom:!1})),this.selectedWallpaper=this.wallpapers.find(e=>e.isEnabled)}loadTheme(){this.theme=document.documentElement.dataset.theme||"default",this.tempTheme=this.theme}formatName(e){return e.replaceAll(" ","-").replace(/.(png|jpeg|jpg)$/,"").toLowerCase()}generateUrl(e){return`${this.pathPrefix}${this.formatName(e)}.png`}init(){this.buttons.open.setAttribute("aria-expanded","false"),this.dialogs.forEach(e=>this.trapFocusInside(e)),this.bindEvents()}bindEvents(){this.buttons.open.addEventListener("click",e=>this.togglePopup(!0,e.pageX)),[this.buttons.close,this.buttons.cancel].forEach(e=>e.addEventListener("click",this.cancelSettings.bind(this))),this.handleWallpaperInput.bind(this),this.form.addEventListener("submit",this.handleSubmit.bind(this)),this.buttons.apply.addEventListener("click",this.applySettings.bind(this)),this.displaySelect.addEventListener("input",this.updateDisplayMode.bind(this)),this.browseInput.addEventListener("input",this.handleUpload.bind(this)),this.themeSelect.addEventListener("input",this.previewTheme.bind(this)),this.alert.closeButtons.forEach(e=>{e.addEventListener("click",this.hideAlert.bind(this))}),this.alert.outer.addEventListener("click",this.handleClickOutsideAlert.bind(this))}togglePopup(e,t=null){let s=e?this.popup:this.buttons.open,i=(0,r.getStateBoolean)(this.popup,"data-minimized");this.buttons.open.setAttribute("aria-expanded",`${e}`),this.popup.hidden=!e,(0,r.removeOutlineFromElement)(this.popup,t),s.focus(),this.loadWallpaperInputs(e),document.documentElement.dispatchEvent(new CustomEvent("settingstoggled",{detail:{isOpen:e}})),e&&this.popup.dispatchEvent(new Event("mousedown")),e&&i&&this.popup.dispatchEvent(new CustomEvent("toggleminimize",{detail:{windowEl:this.popup}})),e||(0,r.updatePageHookWindow)(this.popup,!0)}trapFocusInside(e){let t=e.querySelectorAll('a[href], button, input, textarea, select, [tabindex]:not([tabindex="-1"])'),s=t[0],i=t[t.length-1];this.addFocusTrapListeners(s,i)}addFocusTrapListeners(e,t){let s=s=>{"Tab"!==s.key||(s.shiftKey&&s.target===e?(s.preventDefault(),t.focus()):s.shiftKey||s.target!==t||(s.preventDefault(),e.focus()))};[e,t].forEach(e=>e.addEventListener("keydown",s))}cancelSettings(){this.setTheme(!0),this.togglePopup(!1)}loadWallpaperInputs(e){this.wallpaperInputs=[...this.wallpaperLabels].map(e=>e.firstElementChild),e?this.wallpaperInputs.forEach(e=>e.addEventListener("input",e=>this.handleWallpaperInput(e))):this.wallpaperInputs.forEach(e=>e.removeEventListener("input",e=>this.handleWallpaperInput(e)))}handleWallpaperInput(e){let{target:t}=e;"radio"===t.type&&(this.updatePreview(t.value),this.displaySelect.dispatchEvent(new Event("input")))}updatePreview(e){this.setWallpaper(this.previewBox,e)}setWallpaper(e,t){if(this.selectedWallpaper=this.wallpapers.find(e=>e.name===t),this.selectedWallpaper){let{src:t}=this.selectedWallpaper;e.style.setProperty("--wallpaper",`url("${t}")`)}else e.style.setProperty("--wallpaper","none")}handleSubmit(e){e.preventDefault(),this.applySettings(),this.togglePopup(!1)}saveSettings(){this.setLocalStorageItem("wallpapers",this.wallpapers),this.setLocalStorageItem("display-mode",this.displayMode),this.setLocalStorageItem("preview-ratio",this.previewRatio),this.setLocalStorageItem("switcher",this.switcher.innerHTML),this.setLocalStorageItem("theme",this.theme)}setLocalStorageItem(e,t){if(t){t="object"==typeof t?JSON.stringify(t):t;try{localStorage.setItem(e,t)}catch(e){if("QuotaExceededError"===e.name)console.error("Local storage is full. Please free up some space.");else throw e}}}applySettings(){let e=[...this.wallpaperInputs].find(e=>e.checked),t=e.value;this.displayMode=this.displaySelect.value,this.setWallpaper(a.root,t),this.setDisplayStyle(a.root,this.displayMode),this.setActiveWallpaper(t),this.resetAppliedClass(e),this.setTheme(!1),this.saveSettings()}resetAppliedClass(e=null){[...this.wallpaperInputs].forEach(e=>e.classList.remove("applied")),e&&e.classList.add("applied")}updateDisplayMode(e){this.displayMode=e.currentTarget.value,this.setDisplayStyle(this.previewBox,this.displayMode)}async setDisplayStyle(e,t){Object.entries({center:{size:"auto",repeat:"no-repeat",position:"center"},tile:{size:"auto",repeat:"repeat",position:"auto"},stretch:{size:"100% 100%",repeat:"no-repeat",position:"auto"}}[t]).forEach(([t,s])=>e.style.setProperty(`--${t}`,s)),this.previewRatio="stretch"!==t?await this.getPreviewRatio():"100% 100%",e.style.setProperty("--preview-size",this.previewRatio)}loadImage(e){return new Promise((t,s)=>{let i=document.createElement("img");i.onload=()=>t(i),i.onerror=s,i.src=e})}calculatePreviewRatio(e,t,s){let{naturalHeight:i,naturalWidth:a}=e;return e.remove(),`${Math.round(100*a/t)}% ${Math.round(100*i/s)}%`}async getPreviewRatio(){let e=a.root.offsetWidth,t=a.root.offsetHeight;if(this.selectedWallpaper)try{let s=await this.loadImage(this.selectedWallpaper.src);return this.calculatePreviewRatio(s,e,t)}catch(e){console.error("Failed to load image:",e)}return"100% 100%"}async handleUpload(e){let t=e.target.files[0],s=this.formatName(t.name),i=t.size;if(!this.validateFile(i,s)){this.browseInput.value=null;return}try{let e=await this.readFile(t);this.addCustomWallpaper(t,e)}catch(e){console.error("Error reading file:",e)}}addCustomWallpaper(e,t){let s={name:this.formatName(e.name),src:t,isEnabled:!1,isCustom:!0};this.wallpapers.push(s),this.setLocalStorageItem("wallpapers",this.wallpapers),this.updateSwitcher(s)}readFile(e){return new Promise((t,s)=>{let i=new FileReader;i.onload=e=>{t(e.target.result)},i.onerror=s,i.readAsDataURL(e)})}setActiveWallpaper(e){this.selectedWallpaper=this.wallpapers.find(t=>t.name===e),this.wallpapers.forEach(e=>{e.isEnabled=e===this.selectedWallpaper})}validateFile(e,t){let s=this.wallpapers.find(e=>e.name===t);return e>1048576?(this.showAlert("File Size Exceeds Limit","The file size exceeds the limit of 1MB. Please upload a smaller file."),!1):!s||(this.showAlert("Duplicate File Name",`A file named "${t}" has already been uploaded. Please upload a different file.`),!1)}showAlert(e,t){this.alert.heading.innerText=e,this.alert.message.innerText=t,this.alert.outer.hidden=!1,this.alert.container.focus(),this.alert.container.dispatchEvent(new Event("mousedown"))}hideAlert(){this.alert.outer.hidden=!0,this.browseInput.focus()}handleClickOutsideAlert(e){e.target===this.alert.outer&&this.hideAlert()}updateSwitcher(e){let t=document.createElement("label");t.classList.add("wallpaper"),t.setAttribute("for",this.formatName(e.name));let s=document.createElement("input");s.type="radio",s.name="wallpaper",s.value=this.formatName(e.name),s.id=this.formatName(e.name),s.checked=!0;let i=document.createElement("img");i.src=this.switcher.querySelector("img").src,i.alt="";let a=document.createElement("span");a.innerText=e.name,t.append(s,i,a),this.switcher.appendChild(t),s.focus(),this.loadWallpaperInputs(!0),s.dispatchEvent(new Event("input")),this.setLocalStorageItem("switcher",this.switcher.innerHTML)}previewTheme(e){this.tempTheme=e.currentTarget.value;let t=`${this.pathPrefix}${this.tempTheme}.png`;(0,a.root).style.setProperty("--theme-preview",`url("${t}")`)}setTheme(e){let t=e?this.theme:this.tempTheme,s=`${this.pathPrefix}${t}.png`;(0,a.root).style.setProperty("--theme-preview",`url("${s}")`),this.theme=t,this.tempTheme=this.theme,this.themeSelect.value=this.theme,document.documentElement.dataset.theme=this.theme}}new n;var o=n}),s("fow3s",function(t,s){e(t.exports,"root",function(){return i});let i=document.querySelector(".root");i.querySelector("main"),i.querySelector("header"),i.querySelector("footer"),i.querySelectorAll(".window")}),s("cbNRq",function(t,s){e(t.exports,"getDraggableType",function(){return i}),e(t.exports,"getDraggableItemName",function(){return a}),e(t.exports,"checkIfOverlap",function(){return r}),e(t.exports,"populateStorage",function(){return l}),e(t.exports,"getLastPositionFromLocalStorage",function(){return n}),e(t.exports,"getMaxZIndex",function(){return o}),e(t.exports,"getStateBoolean",function(){return p}),e(t.exports,"getCorrespondingTaskButton",function(){return h}),e(t.exports,"getCorrespondingWindow",function(){return u}),e(t.exports,"removeOutlineFromElement",function(){return d}),e(t.exports,"updatePageHookWindow",function(){return c});let i=e=>e.target.dataset.draggable,a=e=>e.target.dataset.item,r=(e,t)=>"icon"!==i(e)?null:(t=t.filter(e=>"true"!==e.dataset.minimized)).some(t=>e.hitTest(t,"25%")),l=(e,t)=>{localStorage.setItem(e,JSON.stringify(t))},n=e=>JSON.parse(localStorage.getItem(`${e.target.dataset.item}-position`)),o=([e,t])=>{let s=[getComputedStyle(e).zIndex,getComputedStyle(t).zIndex];return(s=s.map(e=>"auto"===e?0:parseInt(e))).reduce((e,t)=>Math.max(e,t))},p=(e,t)=>"true"===e.getAttribute(t),h=e=>document.querySelector(`#${e.dataset.task}`),u=e=>document.querySelector(`.window[data-task="${e.id}"]`),d=(e,t)=>{t&&(e.classList.add("remove-outline"),e.addEventListener("blur",()=>e.classList.remove("remove-outline"),{once:!0}))},c=(e,t)=>{let s=document.querySelector("#page-hook");s.removeAttribute("data-window-open"),s.removeAttribute("data-popup-open"),t||s.setAttribute(`data-${e.dataset.item}-open`,"")}}),s("fLH6v",function(t,s){e(t.exports,"wallpapers",function(){return i});let i=["Black Thatch","Blue Rivets","Bubbles","Carved Stone","Circles","Clouds","Forest","Gold Weave","Houndstooth","Metal Links","Pinstripe","Red Blocks","Sandstone","Setup","Stitches","Straw Mat","Tiles","Triangles","Waves"]})}();
//# sourceMappingURL=settings.3fc62057.js.map
